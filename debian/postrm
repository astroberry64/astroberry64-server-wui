#!/bin/bash
# postrm script for astroberry-server-wui

RED='\033[0;31m'
NC='\033[0m'

# Disable astroberry site
rm -rf /etc/nginx/sites-enabled/astroberry || true
rm -rf /etc/nginx/sites-enabled/astroberry_ssl || true

# Reactivate default site for nginx
ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

# Reload nginx configuration
systemctl reload nginx

# Remove astroberry version file
rm -rf /var/www/html/version.html || true

# Remove indiweb and dependencies
indiweb_dir="$(pip3 show indiweb | grep Location|cut -d: -f2 | xargs)/indiweb"
if [ $indiweb_dir ]; then
    mv -f $indiweb_dir/views/css/schoolhouse.css.bak $indiweb_dir/views/css/schoolhouse.css
    rm -rf $indiweb_dir/views/img/webmanager.svg
    rm -rf $indiweb_dir/views/fonts/Roboto-Light.ttf
fi
pip3 uninstall -y gps3 python-socketio indiweb ephem
